# OT Data Simulator Configuration
# Professional-grade simulator for OPC-UA, MQTT, and Modbus protocols

# General Settings
simulator:
  name: "Databricks OT Data Simulator"
  log_level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  log_file: "ot_simulator.log"

# Web UI Configuration
web_ui:
  enabled: true
  host: "0.0.0.0"
  port: 8989  # Default for local dev; overridden by DATABRICKS_APP_PORT in production
  auto_open_browser: false

# OPC-UA Server Configuration
opcua:
  enabled: true
  endpoint: "opc.tcp://0.0.0.0:4841/ot-simulator/server/"
  server_name: "OT Data Simulator - OPC UA"
  namespace_uri: "http://databricks.com/iot-simulator"

  # Security Configuration (OPC UA 10101 compliant)
  # TEMPORARILY COMMENTED OUT - OPCUAConfig dataclass doesn't have security field yet
  # security:
  #   # Enable/disable security (set to false for development)
  #   enabled: false  # Set to true to enable Basic256Sha256 + certificates

  #   # Security policy: Basic256Sha256 (OPC UA 10101 recommended)
  #   security_policy: "Basic256Sha256"  # Basic256Sha256, NoSecurity
  #   security_mode: "SignAndEncrypt"  # Sign, SignAndEncrypt

  #   # Certificate paths (required if security enabled)
  #   server_cert_path: "ot_simulator/certs/server_cert.pem"
  #   server_key_path: "ot_simulator/certs/server_key.pem"

  #   # Trusted client certificates directory (auto-created if missing)
  #   trusted_certs_dir: "ot_simulator/certs/trusted"

  #   # Username/password authentication (optional, works with or without certificates)
  #   enable_user_auth: false  # Set to true to require login
  #   users:
  #     # Format: username: password
  #     admin: "databricks123"
  #     operator: "operator123"
  #     readonly: "readonly123"

  # Update frequency
  update_rate_hz: 2.0  # Updates per second (default 2 Hz)

  # Which industries to simulate (LIMITED: only mining, utilities, renewable_energy)
  industries:
    - mining
    - utilities
    - renewable_energy

# MQTT Publisher Configuration
mqtt:
  enabled: false  # DISABLED - OPC UA only

  # Broker settings (publish to external broker)
  broker:
    host: "localhost"
    port: 1883
    use_tls: false
    tls_port: 8883

  # Authentication (optional)
  auth:
    username: ""
    password: ""

  # Client settings
  client_id: "ot-simulator-publisher"
  clean_session: true
  keepalive: 60
  qos: 1  # 0, 1, or 2

  # Topic structure
  # sensors/{industry}/{sensor_name}/value
  # sensors/{industry}/{sensor_name}/metadata
  topic_prefix: "sensors"

  # Payload format
  payload_format: "sparkplug_b"  # json, string, sparkplug_b (Ignition-compatible)
  include_metadata: true
  include_timestamp: true

  # Publishing settings
  publish_rate_hz: 2.0  # Publications per second
  batch_publish: false  # Publish all at once vs individual

  # Which industries to simulate (LIMITED: only mining, utilities, renewable_energy)
  industries:
    - mining
    - utilities
    - renewable_energy

# Modbus Server Configuration
modbus:
  enabled: false  # DISABLED - OPC UA only

  # TCP Server
  tcp:
    enabled: true
    host: "0.0.0.0"
    port: 5020  # Standard Modbus is 502, using 5020 to avoid privileged port

  # RTU Server (Serial) - Optional
  rtu:
    enabled: false
    port: "/dev/ttyUSB0"  # Linux: /dev/ttyUSB0, Windows: COM3
    baudrate: 9600
    parity: "N"  # N (None), E (Even), O (Odd)
    stopbits: 1
    bytesize: 8

  # Slave settings
  slave_id: 1

  # Register mapping
  # Each industry gets 1000 registers starting at offset
  register_mapping:
    mining:
      start_address: 0
      count: 1000
      type: "holding"  # holding, input
    utilities:
      start_address: 1000
      count: 1000
      type: "holding"
    manufacturing:
      start_address: 2000
      count: 1000
      type: "holding"
    oil_gas:
      start_address: 3000
      count: 1000
      type: "holding"
    aerospace:
      start_address: 4000
      count: 1000
      type: "holding"
    space:
      start_address: 5000
      count: 1000
      type: "holding"
    water_wastewater:
      start_address: 6000
      count: 1000
      type: "holding"
    renewable_energy:
      start_address: 7000
      count: 1000
      type: "holding"
    automotive:
      start_address: 8000
      count: 1000
      type: "holding"
    chemical:
      start_address: 9000
      count: 1000
      type: "holding"
    food_beverage:
      start_address: 10000
      count: 1000
      type: "holding"
    pharmaceutical:
      start_address: 11000
      count: 1000
      type: "holding"
    data_center:
      start_address: 12000
      count: 1000
      type: "holding"
    smart_building:
      start_address: 13000
      count: 1000
      type: "holding"
    agriculture:
      start_address: 14000
      count: 1000
      type: "holding"

  # Value encoding
  # Modbus registers are 16-bit integers
  # Floating point values are scaled: value * scale_factor
  scale_factor: 10  # 42.5Â°C stored as 425

  # Update settings
  update_rate_hz: 2.0

  # Which industries to simulate (LIMITED: only mining, utilities, renewable_energy)
  industries:
    - mining
    - utilities
    - renewable_energy

# Industry-Specific Sensor Configurations
# These can override defaults from sensor_models.py

sensors:
  # Global overrides
  global:
    anomaly_probability: 0.001  # 0.1% chance per update
    anomaly_magnitude: 2.0      # Multiplier for anomalies
    noise_multiplier: 1.0       # Scale noise (1.0 = default)

  # Industry-specific overrides (LIMITED: only mining, utilities, renewable_energy enabled)
  mining:
    enabled: true

  utilities:
    enabled: true

  renewable_energy:
    enabled: true

  # DISABLED industries
  manufacturing:
    enabled: false

  oil_gas:
    enabled: false

  aerospace:
    enabled: false

  space:
    enabled: false

  water_wastewater:
    enabled: false

  automotive:
    enabled: false

  chemical:
    enabled: false

  food_beverage:
    enabled: false

  pharmaceutical:
    enabled: false

  data_center:
    enabled: false

  smart_building:
    enabled: false

  agriculture:
    enabled: false

# Fault Injection Configuration
faults:
  enabled: true

  # Automatic random faults
  auto_inject: false
  auto_inject_interval_seconds: 300  # Every 5 minutes
  auto_inject_duration_seconds: 30   # 30 second faults

  # Fault types to inject
  fault_types:
    - spike       # Sudden value spike
    - drift       # Slow drift out of range
    - oscillation # High-frequency oscillation
    - freeze      # Value stuck
    - noise       # Excessive noise

  # Which industries/sensors can have auto faults
  targets:
    - mining/*
    - utilities/*
    - manufacturing/*
    - oil_gas/*

# Monitoring & Metrics
monitoring:
  # Prometheus metrics endpoint
  prometheus:
    enabled: true
    port: 9091  # Changed from 9090 to avoid conflicts
    path: "/metrics"

  # Statistics
  stats:
    enabled: true
    update_interval_seconds: 10

    metrics:
      - sensor_updates_total
      - sensor_anomalies_total
      - sensor_current_values
      - simulator_uptime_seconds
      - protocol_clients_connected

# Data Recording (Optional)
recording:
  enabled: false
  output_dir: "./recordings"
  format: "csv"  # csv, parquet, json
  rotation_interval_seconds: 3600  # New file every hour
  compression: "gzip"

# Performance Tuning
performance:
  # Threading/async settings
  max_concurrent_updates: 100
  queue_size: 10000

  # Memory limits
  max_sensor_history: 1000  # Keep last N values per sensor

  # CPU throttling
  cpu_limit_percent: 80  # Throttle if above this

# Presets for Quick Configuration
presets:
  # Minimal - Single industry, low update rate
  minimal:
    opcua:
      update_rate_hz: 0.5
      industries: [manufacturing]
    mqtt:
      enabled: false
    modbus:
      enabled: false

  # Development - All protocols, medium update rate
  development:
    opcua:
      update_rate_hz: 1.0
    mqtt:
      update_rate_hz: 1.0
    modbus:
      update_rate_hz: 1.0

  # Production - All protocols, high update rate
  production:
    opcua:
      update_rate_hz: 2.0
    mqtt:
      update_rate_hz: 2.0
    modbus:
      update_rate_hz: 2.0

  # Demo - All industries, with auto faults
  demo:
    faults:
      auto_inject: true
      auto_inject_interval_seconds: 180
    opcua:
      industries: [mining, utilities, manufacturing, oil_gas]
    mqtt:
      industries: [mining, utilities, manufacturing, oil_gas]
    modbus:
      industries: [mining, utilities, manufacturing, oil_gas]

# Active preset (comment out to use explicit config above)
# active_preset: "development"
