import{u as E,r as a,j as e,P as n,F as l,T as o,B as m}from"./index-D7osG2pV.js";import{s as c}from"./simApi-GdAodEFA.js";function J(){const t=E(),[d,v]=a.useState(""),[u,f]=a.useState(""),[h,S]=a.useState("60"),[p,N]=a.useState("operator1"),[j,C]=a.useState(null),[T,k]=a.useState(null),[x,y]=a.useState(!1),[w,b]=a.useState(""),g=a.useCallback(async()=>{y(!0);try{const[s,r]=await Promise.all([c.listScenarios(),c.leaderboard()]);C(s),k(r)}catch(s){t.show(s instanceof Error?s.message:"Failed to load training data","bad")}finally{y(!1)}},[t]);a.useEffect(()=>{g().catch(()=>{})},[g]);const R=a.useCallback(async()=>{const s=Number(h),r=u;try{const i=await c.injectData(d.trim(),r,Number.isFinite(s)?s:void 0);b(JSON.stringify(i,null,2)),t.show("Injection sent","ok")}catch(i){t.show(i instanceof Error?i.message:"Inject failed","bad")}},[h,d,t,u]),I=a.useCallback(async s=>{try{const r=await c.runScenario(s,p.trim());b(JSON.stringify(r,null,2)),t.show("Scenario started","ok")}catch(r){t.show(r instanceof Error?r.message:"Run scenario failed","bad")}},[t,p]);return e.jsxs("div",{style:{display:"grid",gap:16},children:[e.jsxs(n,{title:"Training",subtitle:"Fault injection, scenarios, replay",actions:e.jsx(m,{type:"button",onClick:()=>g(),disabled:x,children:x?"Refreshing...":"Refresh"}),children:[e.jsxs("div",{className:"muted",style:{marginBottom:10},children:["Uses ",e.jsx("code",{children:"/api/training/*"})," endpoints (inject, scenarios, run, submit diagnosis, leaderboard)."]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:10},children:[e.jsx(l,{label:"Sensor path",children:e.jsx(o,{value:d,onChange:s=>v(s.target.value),placeholder:"mining.crusher.bearing_temp"})}),e.jsx(l,{label:"Value",children:e.jsx(o,{value:u,onChange:s=>f(s.target.value),placeholder:"95.5"})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10,marginTop:10},children:[e.jsx(l,{label:"Duration (seconds)",children:e.jsx(o,{value:h,onChange:s=>S(s.target.value),placeholder:"60"})}),e.jsx(l,{label:"Trainee ID",children:e.jsx(o,{value:p,onChange:s=>N(s.target.value),placeholder:"operator1"})}),e.jsx("div",{style:{display:"flex",alignItems:"end"},children:e.jsx(m,{variant:"primary",type:"button",onClick:()=>R(),children:"Inject"})})]})]}),e.jsx(n,{title:"Scenarios",subtitle:"Run a saved fault scenario",children:e.jsx("div",{style:{display:"grid",gap:10},children:Array.isArray(j?.scenarios)?j.scenarios.map(s=>e.jsxs("div",{style:{border:"1px solid var(--border-panel)",borderRadius:2,padding:12},children:[e.jsx("div",{className:"section-title",children:String(s?.name??s?.scenario_id??"Scenario")}),e.jsx("div",{className:"muted",style:{marginTop:6},children:String(s?.description??"")}),e.jsx("div",{style:{marginTop:10},children:e.jsx(m,{variant:"primary",type:"button",onClick:()=>I(String(s?.scenario_id)),children:"Run"})})]},String(s?.scenario_id??s?.name??""))):e.jsx("div",{className:"muted",children:"No scenarios loaded yet."})})}),e.jsx(n,{title:"Leaderboard",subtitle:"Raw JSON",children:e.jsx("pre",{className:"kvs",style:{margin:0},children:e.jsx("code",{style:{color:"var(--text-primary)"},children:JSON.stringify(T,null,2)})})}),e.jsx(n,{title:"Last result",subtitle:"Raw JSON",children:e.jsx("pre",{className:"kvs",style:{margin:0},children:e.jsx("code",{style:{color:"var(--text-primary)"},children:w||"â€”"})})})]})}export{J as TrainingPage};
