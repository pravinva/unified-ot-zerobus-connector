import{u as S,r as i,j as t,P as x,S as a,B as d}from"./index-D7osG2pV.js";import{s as f}from"./simApi-GdAodEFA.js";import{u as y}from"./useSimulatorWs-BS671Sgl.js";function C(){const c=S(),o=y(),[u,k]=i.useState(null),[n,w]=i.useState(null),[m,p]=i.useState(!1),l=i.useCallback(async()=>{p(!0);try{const[s,r]=await Promise.all([f.getHealth(),f.zeroBusStatus()]);k(s),w(r)}catch(s){c.show(s instanceof Error?s.message:"Failed to refresh","bad")}finally{p(!1)}},[c]);i.useEffect(()=>{l().catch(()=>{});const s=window.setInterval(()=>l().catch(()=>{}),8e3);return()=>window.clearInterval(s)},[l]);const g=n?.status??{},e=s=>!!g?.[s]?.active,b=o.status?.simulators??{},j=s=>b?.[s]??{};return t.jsxs("div",{style:{display:"grid",gap:16},children:[t.jsxs(x,{title:"Overview",subtitle:"Health + high-level status",actions:t.jsx(d,{type:"button",onClick:()=>l(),disabled:m,children:m?"Refreshing...":"Refresh"}),children:[t.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[t.jsxs(a,{kind:u?"ok":"warn",children:["Health: ",u?"ok":"unknown"]}),t.jsxs(a,{kind:n&&(e("opcua")||e("mqtt")||e("modbus"))?"ok":"warn",children:["ZeroBus: ",n?e("opcua")||e("mqtt")||e("modbus")?"active":"idle":"unknown"]}),t.jsxs(a,{kind:o.connected?"ok":"warn",children:["WS: ",o.connected?"connected":"disconnected"]}),t.jsxs(a,{kind:n&&e("opcua")?"ok":"warn",children:["OPC-UA stream: ",n?e("opcua")?"on":"off":"?"]}),t.jsxs(a,{kind:n&&e("mqtt")?"ok":"warn",children:["MQTT stream: ",n?e("mqtt")?"on":"off":"?"]}),t.jsxs(a,{kind:n&&e("modbus")?"ok":"warn",children:["Modbus stream: ",n?e("modbus")?"on":"off":"?"]})]}),t.jsx("div",{className:"muted",style:{marginTop:10},children:"Start/stop protocol simulators is executed via WebSocket NLP commands (same contract as legacy)."})]}),t.jsx(x,{title:"Protocol controls",subtitle:"Start/stop via WebSocket (nlp_command)",children:["opcua","mqtt","modbus"].map(s=>{const r=j(s),h=!!r?.running;return t.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",flexWrap:"wrap",padding:"8px 0"},children:[t.jsx("div",{style:{minWidth:120,fontFamily:"var(--font-data)"},children:t.jsx("strong",{children:s.toUpperCase()})}),t.jsx(a,{kind:h?"ok":"warn",children:h?"running":"stopped"}),t.jsxs("span",{className:"muted",children:["sensors: ",String(r?.sensor_count??"—")]}),t.jsxs("span",{className:"muted",children:["updates: ",String(r?.update_count??"—")]}),t.jsxs("span",{className:"muted",children:["errors: ",String(r?.errors??"—")]}),t.jsxs("div",{style:{display:"flex",gap:10,marginLeft:"auto"},children:[t.jsx(d,{variant:"primary",type:"button",onClick:()=>{o.startProtocol(s)||c.show("WebSocket not connected","warn")},disabled:!o.connected,children:"Start"}),t.jsx(d,{variant:"danger",type:"button",onClick:()=>{o.stopProtocol(s)||c.show("WebSocket not connected","warn")},disabled:!o.connected,children:"Stop"})]})]},s)})})]})}export{C as OverviewPage};
