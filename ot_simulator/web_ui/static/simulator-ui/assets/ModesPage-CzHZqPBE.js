import{u as b,r as a,j as e,P as l,B as o}from"./index-D7osG2pV.js";import{s as r}from"./simApi-GdAodEFA.js";function k(){const i=b(),[c,g]=a.useState(null),[p,y]=a.useState(null),[u,h]=a.useState(null),[x,f]=a.useState(null),[d,m]=a.useState(!1),n=a.useCallback(async()=>{m(!0);try{const[s,t,v,S]=await Promise.all([r.getModes(),r.comprehensiveMetrics(),r.recentMessages(),r.activeTopics()]);g(s),y(t),h(v),f(S)}catch(s){i.show(s instanceof Error?s.message:"Failed to load modes","bad")}finally{m(!1)}},[i]);a.useEffect(()=>{n().catch(()=>{})},[n]);const j=a.useCallback(async s=>{try{const t=await r.toggleMode(s);i.show(String(t?.message??"Toggled"),t?.success===!1?"warn":"ok"),await n()}catch(t){i.show(t instanceof Error?t.message:"Toggle failed","bad")}},[n,i]);return e.jsxs("div",{style:{display:"grid",gap:16},children:[e.jsxs(l,{title:"Vendor modes",subtitle:"Kepware / Honeywell / Sparkplug B / Generic",actions:e.jsx(o,{type:"button",onClick:()=>n(),disabled:d,children:d?"Refreshing...":"Refresh"}),children:[e.jsxs("div",{className:"muted",style:{marginBottom:10},children:["Uses ",e.jsx("code",{children:"/api/modes*"})," endpoints (toggle, diagnostics, metrics, recent messages, topics)."]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(260px, 1fr))",gap:12},children:Array.isArray(c?.modes)?c.modes.map(s=>e.jsxs("div",{style:{border:"1px solid var(--border-panel)",borderRadius:2,padding:12},children:[e.jsx("div",{className:"section-title",children:String(s?.display_name??s?.mode_type??s?.name??"mode")}),e.jsxs("div",{className:"muted",style:{marginTop:6},children:["Status: ",String(s?.enabled??s?.active??"unknown")]}),e.jsxs("div",{style:{marginTop:10,display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx(o,{variant:"primary",type:"button",onClick:()=>j(String(s?.mode_type??s?.name??"")),children:"Toggle"}),e.jsx(o,{type:"button",onClick:async()=>{try{const t=await r.modeDiagnostics(String(s?.mode_type??s?.name??""));i.show("Diagnostics loaded","ok"),alert(JSON.stringify(t,null,2))}catch(t){i.show(t instanceof Error?t.message:"Diagnostics failed","bad")}},children:"Diagnostics"})]})]},String(s?.mode_type??s?.name??""))):e.jsx("div",{className:"muted",children:"No mode list available yet."})})]}),e.jsx(l,{title:"Comprehensive metrics",subtitle:"Raw JSON",children:e.jsx("pre",{className:"kvs",style:{margin:0},children:e.jsx("code",{style:{color:"var(--text-primary)"},children:JSON.stringify(p,null,2)})})}),e.jsx(l,{title:"Recent messages",subtitle:"Raw JSON",children:e.jsx("pre",{className:"kvs",style:{margin:0},children:e.jsx("code",{style:{color:"var(--text-primary)"},children:JSON.stringify(u,null,2)})})}),e.jsx(l,{title:"Active topics",subtitle:"Raw JSON",children:e.jsx("pre",{className:"kvs",style:{margin:0},children:e.jsx("code",{style:{color:"var(--text-primary)"},children:JSON.stringify(x,null,2)})})})]})}export{k as ModesPage};
