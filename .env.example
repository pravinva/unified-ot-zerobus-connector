# ==============================================================================
# Unified OT Zerobus Connector - Environment Variables
# ==============================================================================
#
# Copy this file to .env and fill in your values:
#   cp .env.example .env
#
# SECURITY: Never commit .env to git! It's already in .gitignore
#

# ------------------------------------------------------------------------------
# OAuth2 Authentication (NIS2 Compliance - Article 21.2(g))
# ------------------------------------------------------------------------------
# Configure your OAuth provider credentials for Web UI authentication

# Azure AD (Azure Active Directory)
OAUTH_CLIENT_ID=your-azure-app-client-id
OAUTH_CLIENT_SECRET=your-azure-app-client-secret
OAUTH_TENANT_ID=your-azure-tenant-id

# For Okta, use:
# OAUTH_CLIENT_ID=your-okta-client-id
# OAUTH_CLIENT_SECRET=your-okta-client-secret
# (No tenant ID needed for Okta)

# For Google, use:
# OAUTH_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
# OAUTH_CLIENT_SECRET=your-google-client-secret
# (No tenant ID needed for Google)

# OAuth Redirect URI (must match your OAuth app configuration)
# Default: http://localhost:8082/login/callback
# For production: https://your-domain.com/login/callback

# ------------------------------------------------------------------------------
# Session Security (Required for NIS2 Compliance)
# ------------------------------------------------------------------------------
# Generate a secure random key with:
#   python -c "import secrets; print(secrets.token_urlsafe(32))"
#
# IMPORTANT: Keep this secret! Never share or commit to git!
SESSION_SECRET_KEY=generate-a-secure-random-key-here

# Session timeout in seconds (default: 28800 = 8 hours)
# SESSION_MAX_AGE_SECONDS=28800

# ------------------------------------------------------------------------------
# Connector Master Password (Credential Encryption)
# ------------------------------------------------------------------------------
# Used to encrypt credentials stored by the connector
# IMPORTANT: Choose a strong password and keep it secret!
CONNECTOR_MASTER_PASSWORD=your-secure-master-password

# ------------------------------------------------------------------------------
# ZeroBus OAuth Credentials (Databricks Data Ingestion)
# ------------------------------------------------------------------------------
# OAuth credentials for Databricks ZeroBus streaming
# These can also be configured via the Web UI
CONNECTOR_ZEROBUS_CLIENT_ID=your-databricks-oauth-client-id
CONNECTOR_ZEROBUS_CLIENT_SECRET=your-databricks-oauth-client-secret

# ------------------------------------------------------------------------------
# Optional: Connector Configuration
# ------------------------------------------------------------------------------
# Override default log level (default: INFO)
# CONNECTOR_LOG_LEVEL=DEBUG

# ------------------------------------------------------------------------------
# Optional: Proxy Configuration (for Purdue Layer 3.5 deployments)
# ------------------------------------------------------------------------------
# If your connector is deployed in a DMZ and needs to route Databricks
# traffic through a corporate proxy on port 443:

# HTTP_PROXY=http://proxy.company.com:8080
# HTTPS_PROXY=http://proxy.company.com:8080

# Bypass proxy for OT devices on local networks (CIDR notation)
# NO_PROXY=localhost,127.0.0.1,192.168.0.0/16,10.0.0.0/8,172.16.0.0/12

# ==============================================================================
# Setup Instructions
# ==============================================================================
#
# 1. Azure AD Setup:
#    - Go to Azure Portal > App Registrations > New registration
#    - Name: "Unified OT Connector"
#    - Redirect URI: http://localhost:8082/login/callback (Web)
#    - After creation, copy:
#      - Application (client) ID → OAUTH_CLIENT_ID
#      - Directory (tenant) ID → OAUTH_TENANT_ID
#    - Go to "Certificates & secrets" > New client secret
#      - Copy secret value → OAUTH_CLIENT_SECRET
#    - Go to "API permissions" > Add permission
#      - Microsoft Graph > Delegated > User.Read, email, openid, profile
#    - Optional: Create Azure AD groups for RBAC:
#      - OT-Admins (full access)
#      - OT-Operators (read/write/start/stop)
#      - OT-Viewers (read-only)
#
# 2. Okta Setup:
#    - Go to Okta Admin Console > Applications > Create App Integration
#    - Sign-in method: OIDC
#    - Application type: Web Application
#    - Grant type: Authorization Code
#    - Sign-in redirect URIs: http://localhost:8082/login/callback
#    - After creation, copy:
#      - Client ID → OAUTH_CLIENT_ID
#      - Client secret → OAUTH_CLIENT_SECRET
#    - In config.yaml, set: provider: okta
#    - Update oauth.authorization_url and oauth.token_url with your Okta domain
#
# 3. Google OAuth Setup:
#    - Go to Google Cloud Console > APIs & Services > Credentials
#    - Create OAuth client ID
#    - Application type: Web application
#    - Authorized redirect URIs: http://localhost:8082/login/callback
#    - After creation, copy:
#      - Client ID → OAUTH_CLIENT_ID
#      - Client secret → OAUTH_CLIENT_SECRET
#    - In config.yaml, set: provider: google
#
# 4. Generate Session Secret:
#    python -c "import secrets; print(secrets.token_urlsafe(32))"
#    Copy output → SESSION_SECRET_KEY
#
# 5. Databricks OAuth (for ZeroBus):
#    - Go to Databricks Workspace > Settings > Developer > Service Principals
#    - Create new service principal
#    - Copy client ID and secret → CONNECTOR_ZEROBUS_*
#
# 6. Update config.yaml:
#    - Set web_ui.authentication.enabled: true
#    - Set web_ui.authentication.oauth.provider: azure (or okta/google)
#    - Configure role_mappings to match your OAuth groups
#
# 7. Test Authentication:
#    docker-compose -f docker-compose.unified.yml up
#    Open http://localhost:8082
#    Should redirect to OAuth login
#
# ==============================================================================
# Troubleshooting
# ==============================================================================
#
# Issue: "Invalid redirect URI"
# - Ensure redirect URI matches exactly in OAuth app config
# - Check http vs https
# - Check port number (8082)
#
# Issue: "MFA required" error
# - Ensure user has MFA enabled in Azure AD/Okta
# - Or set require_mfa: false in config.yaml (NOT RECOMMENDED for production)
#
# Issue: "Permission denied" / Wrong role
# - Check user's OAuth groups
# - Verify role_mappings in config.yaml
# - Check logs: grep "assigned role" unified_connector.log
#
# Issue: Session expires immediately
# - Verify SESSION_SECRET_KEY is set
# - Check session.max_age_seconds in config.yaml
# - Ensure cookies are enabled in browser
#
# ==============================================================================
