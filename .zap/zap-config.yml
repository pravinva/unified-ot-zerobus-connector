# OWASP ZAP Configuration for Unified OT Connector
# NIS2 Compliance: Article 21.2(a) - Security Testing

# Application context
contexts:
  - name: "Unified OT Connector"
    url: "http://localhost:8082"
    includePaths:
      - "http://localhost:8082/.*"
    excludePaths:
      - "http://localhost:8082/static/.*\\.(css|js|png|jpg|gif|ico)$"
      - "http://localhost:8082/health"
    authentication:
      type: "session"
      sessionManagement: "cookie"
    users:
      - name: "admin"
        credentials:
          type: "session"
      - name: "viewer"
        credentials:
          type: "session"

# False positive exclusions
excludeRules:
  - id: 10020  # X-Frame-Options Scanner
    reason: "We have X-Frame-Options: DENY"

  - id: 10016  # Web Browser XSS Protection Not Enabled
    reason: "We have X-XSS-Protection: 1; mode=block"

# Scan policies
scanPolicy:
  name: "NIS2 Compliance Scan"
  description: "Security scan for NIS2 Article 21.2 compliance"

  # Attack strength (LOW, MEDIUM, HIGH, INSANE)
  defaultStrength: HIGH

  # Alert threshold (OFF, LOW, MEDIUM, HIGH)
  defaultThreshold: MEDIUM

  # Enabled scanners
  scanners:
    # Injection attacks
    - id: 40018  # SQL Injection
      enabled: true
      strength: HIGH

    - id: 40014  # Command Injection
      enabled: true
      strength: HIGH

    - id: 40019  # External Redirect
      enabled: true
      strength: MEDIUM

    # XSS attacks
    - id: 40012  # Cross Site Scripting (Reflected)
      enabled: true
      strength: HIGH

    - id: 40014  # Cross Site Scripting (Persistent)
      enabled: true
      strength: HIGH

    - id: 40016  # Cross Site Scripting (DOM Based)
      enabled: true
      strength: HIGH

    # Path traversal
    - id: 6      # Path Traversal
      enabled: true
      strength: HIGH

    # Security headers
    - id: 10020  # X-Frame-Options Header Scanner
      enabled: true

    - id: 10021  # X-Content-Type-Options Header Scanner
      enabled: true

    - id: 10096  # Timestamp Disclosure
      enabled: true

    # Authentication
    - id: 10105  # Weak Authentication Method
      enabled: true

    # Session management
    - id: 10054  # Cookie Without Secure Flag
      enabled: true

    - id: 10055  # Cookie Without HttpOnly Flag
      enabled: true

    # Information disclosure
    - id: 10037  # Server Leaks Information via "X-Powered-By"
      enabled: true

    - id: 10040  # Secure Pages Include Mixed Content
      enabled: true

# Reporting
reporting:
  format: ["html", "json", "xml"]
  outputDir: "./security-reports"
  includePassedTests: false
  includeFalsePositives: false

  # Risk levels to report
  minRiskLevel: "LOW"  # LOW, MEDIUM, HIGH, CRITICAL

  # Sections to include
  sections:
    - "summary"
    - "alerts"
    - "instances"
    - "recommendations"
    - "references"

# Spider configuration
spider:
  maxDepth: 5
  maxChildren: 10
  maxDuration: 10  # minutes
  threadCount: 5

  # Exclude patterns
  excludePatterns:
    - ".*\\.css$"
    - ".*\\.js$"
    - ".*\\.png$"
    - ".*\\.jpg$"
    - ".*\\.gif$"
    - ".*\\.ico$"
    - ".*/static/.*"

# Active scan configuration
activeScan:
  maxDuration: 30  # minutes
  threadCount: 10
  delayInMs: 0

  # Custom payloads for injection testing
  injectionPayloads:
    command:
      - "; ls -la"
      - "| cat /etc/passwd"
      - "`whoami`"
      - "$(uname -a)"

    path:
      - "../../../etc/passwd"
      - "..\\..\\..\\windows\\system32\\config\\sam"
      - "....//....//....//etc/passwd"

    xss:
      - "<script>alert(1)</script>"
      - "<img src=x onerror=alert(1)>"
      - "javascript:alert(1)"
      - "<svg onload=alert(1)>"

# Authentication testing
authenticationTest:
  enabled: true
  testTypes:
    - "weak_passwords"
    - "default_credentials"
    - "session_fixation"
    - "session_timeout"
    - "brute_force_protection"

# Expected results (for CI/CD)
expectedResults:
  maxCritical: 0
  maxHigh: 0
  maxMedium: 2  # Allow 2 medium (e.g., CSP unsafe-inline)
  maxLow: 5

  # Expected warnings (not failures)
  acceptedWarnings:
    - "Content Security Policy (CSP) Header 'unsafe-inline'"
    - "Strict-Transport-Security Header Not Set"  # Only for development

# Integration with CI/CD
ci:
  failBuild: true
  failOn: ["CRITICAL", "HIGH"]
  generateReport: true
  uploadArtifacts: true
